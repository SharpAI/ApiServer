/*
 * videojs-contrib-ads
 * @version 5.1.6
 * @copyright 2018 Brightcove, Inc.
 * @license Apache-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsContribAds=t(e.videojs)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e;var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},a=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},i=function(e,t,n){a(0,n),e.trigger({type:t+n.type,state:e.ads.state,originalEvent:n})},o=function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&i(e,"content",t):e.ads._cancelledPlay?a(0,t):i(e,"ad",t))},s=function(e,t){if(e.ads.isInAdMode()){if(e.ads.isContentResuming())return;i(e,"ad",t)}else i(e,"content",t)},d=function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.isAdPlaying())i(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;i(e,"content",t)}},r=function(e,t){var n=e.ads._cancelledPlay&&!e.ads.isInAdMode();e.ads.isAdPlaying()?i(e,"ad",t):(e.ads.isContentResuming()||n)&&i(e,"content",t)};function c(e){"playing"===e.type?o(this,e):"ended"===e.type?s(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?d(this,e):"play"===e.type?r(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?i(this,"content",e):i(this,"ad",e))}function u(e){e.ads.cancelPlayTimeout||(e.ads.cancelPlayTimeout=n.setTimeout(function(){e.ads.cancelPlayTimeout=null,e.paused()||e.pause(),e.ads._cancelledPlay=!0},1))}var l,f={},p=(Object.freeze||Object)({"default":f}),m=p&&f||p,y=void 0!==t?t:"undefined"!=typeof window?window:{};"undefined"!=typeof document?l=document:(l=y["__GLOBAL_DOCUMENT_CACHE@4"])||(l=y["__GLOBAL_DOCUMENT_CACHE@4"]=m);var h=l,g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T=function(e,t){return t?encodeURIComponent(e):e},v=function(e,t,n){if(e&&e[n])for(var a=e[n],i=Object.keys(a),o=0;o<i.length;o++){t["{mediainfo."+n+"."+i[o]+"}"]=a[i[o]]}};var _={};_.processMetadataTracks=function(e,t){for(var n=e.textTracks(),a=function(n){"metadata"===n.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(n),t(e,n))},i=0;i<n.length;i++)a(n[i]);n.addEventListener("addtrack",function(e){a(e.track)})},_.setMetadataTrackMode=function(e){},_.getSupportedAdCue=function(e,t){return t},_.isSupportedAdCue=function(e,t){return!0},_.getCueId=function(e,t){return t.id};_.processAdTrack=function(t,n,a,i){t.ads.includedCues={};for(var o=0;o<n.length;o++){var s=n[o],d=this.getSupportedAdCue(t,s);if(!this.isSupportedAdCue(t,s))return void e.log.warn("Skipping as this is not a supported ad cue.",s);var r=this.getCueId(t,s),c=s.startTime;if((l=r)!==undefined&&t.ads.includedCues[l])return void e.log("Skipping ad already seen with ID "+r);i&&i(t,d,r,c),a(t,d,r,c),(u=r)!==undefined&&""!==u&&(t.ads.includedCues[u]=!0)}var u,l};var b=e.getTech("Html5").Events,k=function(e){var t=e.$(".vjs-tech");t&&t.removeAttribute("poster")},A={timeout:5e3,prerollTimeout:100,postrollTimeout:100,debug:!1,stitchedAds:!1},S=function(t){var a=this,i=e.mergeOptions(A,t),o=b.concat(["firstplay","loadedalldata","playing"]);a.on(o,c),n.setTimeout(function(){a.ads._hasThereBeenALoadStartDuringPlayerLife||""===a.src()||e.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see https://github.com/videojs/videojs-contrib-ads#important-note-about-initialization")},5e3),a.on("ended",function(){a.hasClass("vjs-has-started")||a.addClass("vjs-has-started")}),a.on(["addurationchange","adcanplay"],function(){a.ads.snapshot&&a.currentSrc()===a.ads.snapshot.currentSrc||a.ads.isAdPlaying()&&a.play()}),a.on("nopreroll",function(){a.ads.nopreroll_=!0}),a.on("nopostroll",function(){a.ads.nopostroll_=!0}),a.on(["ads-ad-started","playing"],function(){a.removeClass("vjs-ad-loading")}),a.on("playing",function(){a.ads._cancelledPlay=!1}),a.one("loadstart",function(){a.ads._hasThereBeenALoadStartDuringPlayerLife=!0}),a.on("loadeddata",function(){a.ads._hasThereBeenALoadedData=!0}),a.on("loadedmetadata",function(){a.ads._hasThereBeenALoadedMetaData=!0}),a.ads={state:"content-set",disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,adType:null,VERSION:"__VERSION__",reset:function(){a.ads.disableNextSnapshotRestore=!1,a.ads._contentEnding=!1,a.ads._contentHasEnded=!1,a.ads.snapshot=null,a.ads.adType=null,a.ads._hasThereBeenALoadedData=!1,a.ads._hasThereBeenALoadedMetaData=!1,a.ads._cancelledPlay=!1},startLinearAdMode:function(){"preroll?"!==a.ads.state&&"content-playback"!==a.ads.state&&"postroll?"!==a.ads.state||(a.ads._inLinearAdMode=!0,a.trigger("adstart"))},endLinearAdMode:function(){"ad-playback"===a.ads.state&&(a.ads._inLinearAdMode=!1,a.trigger("adend"),a.removeClass("vjs-ad-loading"))},skipLinearAdMode:function(){"ad-playback"!==a.ads.state&&a.trigger("adskip")},stitchedAds:function(e){return e!==undefined&&(this._stitchedAds=!!e),this._stitchedAds},videoElementRecycled:function(){if(a.ads.shouldPlayContentBehindAd(a))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var e=a.tech_.src()!==this.snapshot.src,t=a.currentSrc()!==this.snapshot.currentSrc;return e||t},isLive:function(t){return t.duration()===Infinity||"8"===e.browser.IOS_VERSION&&0===t.duration()},shouldPlayContentBehindAd:function(t){return!e.browser.IS_IOS&&!e.browser.IS_ANDROID&&t.duration()===Infinity},isInAdMode:function(){return"ads-ready?"===a.ads.state||"preroll?"===a.ads.state||"ad-playback"===a.ads.state||"content-resuming"===a.ads.state},isContentResuming:function(){return"content-resuming"===a.ads.state},isAdPlaying:function(){return this._inLinearAdMode}},a.ads.stitchedAds(i.stitchedAds),a.ads.cueTextTracks=_,a.ads.adMacroReplacement=function(t,a,i){a===undefined&&(a=!1);var o={};i!==undefined&&(o=i),o["{player.id}"]=this.options_["data-player"],o["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",o["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",o["{mediainfo.description}"]=this.mediainfo?this.mediainfo.description:"",o["{mediainfo.tags}"]=this.mediainfo?this.mediainfo.tags:"",o["{mediainfo.reference_id}"]=this.mediainfo?this.mediainfo.reference_id:"",o["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",o["{mediainfo.ad_keys}"]=this.mediainfo?this.mediainfo.ad_keys:"",o["{player.duration}"]=this.duration(),o["{timestamp}"]=(new Date).getTime(),o["{document.referrer}"]=h.referrer,o["{window.location.href}"]=n.location.href,o["{random}"]=Math.floor(1e12*Math.random()),v(this.mediainfo,o,"custom_fields"),v(this.mediainfo,o,"customFields");for(var s in o)t=t.split(s).join(T(o[s],a));return t=t.replace(/{pageVariable\.([^}]+)}/g,function(t,i){for(var o=void 0,s=n,d=i.split("."),r=0;r<d.length;r++)r===d.length-1?o=s[d[r]]:s=s[d[r]];var c=void 0===o?"undefined":g(o);return null===o?"null":o===undefined?(e.log.warn('Page variable "'+i+'" not found'),""):"string"!==c&&"number"!==c&&"boolean"!==c?(e.log.warn('Page variable "'+i+'" is not a supported type'),""):T(String(o),a)})}.bind(a),function(e){e.ads.contentSrc=e.currentSrc();var t=function(){if("ad-playback"!==e.ads.state){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t)}};e.on("loadstart",t),n.setTimeout(t,1)}(a),a.on("contentupdate",a.ads.reset);var s={"content-set":{events:{adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="ads-ready"},play:function(){this.state="ads-ready?",u(a),k(a)},adserror:function(){this.state="content-playback"},adskip:function(){this.state="content-playback"}}},"ads-ready":{events:{play:function(){this.state="preroll?",u(a)},adskip:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"preroll?":{enter:function(){a.ads.nopreroll_?(a.trigger("readyforpreroll"),n.setTimeout(function(){a.trigger("nopreroll")},1)):(a.addClass("vjs-ad-loading"),a.ads.adTimeoutTimeout=n.setTimeout(function(){a.trigger("adtimeout")},i.prerollTimeout),a.ads._hasThereBeenALoadStartDuringPlayerLife?a.trigger("readyforpreroll"):a.one("loadstart",function(){a.trigger("readyforpreroll")}))},leave:function(){n.clearTimeout(a.ads.adTimeoutTimeout)},events:{play:function(){u(a)},adstart:function(){this.state="ad-playback",a.ads.adType="preroll"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"},nopreroll:function(){this.state="content-playback"}}},"ads-ready?":{enter:function(){a.addClass("vjs-ad-loading"),a.ads.adTimeoutTimeout=n.setTimeout(function(){a.trigger("adtimeout")},i.timeout)},leave:function(){n.clearTimeout(a.ads.adTimeoutTimeout),a.removeClass("vjs-ad-loading")},events:{play:function(){u(a)},adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="preroll?"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ad-playback":{enter:function(){a.ads.shouldPlayContentBehindAd(a)||(this.snapshot=function(t){var n=void 0;n=e.browser.IS_IOS&&t.ads.isLive(t)&&t.seekable().length>0?t.currentTime()-t.seekable().end(0):t.currentTime();var a=t.$(".vjs-tech"),i=t.textTracks?t.textTracks():[],o=[],s={ended:t.ended(),currentSrc:t.currentSrc(),src:t.tech_.src(),currentTime:n,type:t.currentType()};a&&(s.nativePoster=a.poster,s.style=a.getAttribute("style"));for(var d=0;d<i.length;d++){var r=i[d];o.push({track:r,mode:r.mode}),r.mode="disabled"}return s.suppressedTracks=o,s}(a)),a.ads.shouldPlayContentBehindAd(a)&&(this.preAdVolume_=a.volume(),a.volume(0)),a.addClass("vjs-ad-playing"),a.hasClass("vjs-live")&&a.removeClass("vjs-live"),k(a),a.ads.cancelPlayTimeout&&n.setTimeout(function(){n.clearTimeout(a.ads.cancelPlayTimeout),a.ads.cancelPlayTimeout=null},1)},leave:function(){a.removeClass("vjs-ad-playing"),a.ads.isLive(a)&&a.addClass("vjs-live"),a.ads.shouldPlayContentBehindAd(a)||function(t,a){if(!0!==t.ads.disableNextSnapshotRestore){var i=t.$(".vjs-tech"),o=20,s=a.suppressedTracks,d=void 0,r=function(){for(var e=0;e<s.length;e++)(d=s[e]).track.mode=d.mode},c=function(){var n=void 0;e.browser.IS_IOS&&t.ads.isLive(t)?a.currentTime<0&&(n=t.seekable().length>0?t.seekable().end(0)+a.currentTime:t.currentTime(),t.currentTime(n)):a.ended?t.currentTime(t.duration()):t.currentTime(a.currentTime),a.ended||t.play(),t.ads.shouldRemoveAutoplay_&&(t.autoplay(!1),t.ads.shouldRemoveAutoplay_=!1)},u=function l(){if(t.off("contentcanplay",l),t.ads.tryToResumeTimeout_&&(t.clearTimeout(t.ads.tryToResumeTimeout_),t.ads.tryToResumeTimeout_=null),(i=t.el().querySelector(".vjs-tech")).readyState>1)return c();if(i.seekable===undefined)return c();if(i.seekable.length>0)return c();if(o--)n.setTimeout(l,50);else try{c()}catch(a){e.log.warn("Failed to resume the content after an advertisement",a)}};a.nativePoster&&(i.poster=a.nativePoster),"style"in a&&i.setAttribute("style",a.style||""),t.ads.videoElementRecycled()?(t.one("contentloadedmetadata",r),e.browser.IS_IOS&&!t.autoplay()&&(t.autoplay(!0),t.ads.shouldRemoveAutoplay_=!0),t.src({src:a.currentSrc,type:a.type}),t.one("contentcanplay",u),t.ads.tryToResumeTimeout_=t.setTimeout(u,2e3)):(r(),t.ended()||t.play())}else t.ads.disableNextSnapshotRestore=!1}(a,this.snapshot),a.ads.shouldPlayContentBehindAd(a)&&a.volume(this.preAdVolume_)},events:{adend:function(){this.state="content-resuming",a.ads.adType=null},adserror:function(){a.ads.endLinearAdMode()}}},"content-resuming":{enter:function(){this._contentHasEnded&&(n.clearTimeout(a.ads._fireEndedTimeout),a.ads._fireEndedTimeout=n.setTimeout(function(){a.trigger("ended")},1e3))},leave:function(){n.clearTimeout(a.ads._fireEndedTimeout)},events:{contentupdate:function(){this.state="content-set"},contentresumed:function(){this.state="content-playback"},playing:function(){this.state="content-playback"},ended:function(){this.state="content-playback"}}},"postroll?":{enter:function(){a.ads._contentEnding=!0,a.ads.nopostroll_?n.setTimeout(function(){a.ads.state="content-resuming",a.trigger("ended")},1):(a.addClass("vjs-ad-loading"),a.ads.adTimeoutTimeout=n.setTimeout(function(){a.trigger("adtimeout")},i.postrollTimeout))},leave:function(){n.clearTimeout(a.ads.adTimeoutTimeout),a.removeClass("vjs-ad-loading")},events:{adstart:function(){this.state="ad-playback",a.ads.adType="postroll"},adskip:function(){this.state="content-resuming",n.setTimeout(function(){a.trigger("ended")},1)},adtimeout:function(){this.state="content-resuming",n.setTimeout(function(){a.trigger("ended")},1)},adserror:function(){this.state="content-resuming",n.setTimeout(function(){a.trigger("ended")},1)},contentupdate:function(){this.state="ads-ready?"}}},"content-playback":{enter:function(){a.ads.cancelPlayTimeout&&(n.clearTimeout(a.ads.cancelPlayTimeout),a.ads.cancelPlayTimeout=null),a.trigger({type:"contentplayback",triggerevent:a.ads.triggerevent}),a.ads._cancelledPlay&&a.paused()&&a.play()},events:{adsready:function(){a.trigger("readyforpreroll")},adstart:function(){this.state="ad-playback","preroll"!==a.ads.adType&&(a.ads.adType="midroll")},contentupdate:function(){a.paused()?this.state="content-set":this.state="ads-ready?"},contentended:function(){this._contentHasEnded?this.state="content-resuming":(this._contentEnding=!1,this._contentHasEnded=!0,this.state="postroll?")}}}},d=function(t){var n=a.ads.state,o=s[n].events;if(o){var d=o[t.type];d&&d.apply(a.ads)}if(n!==a.ads.state){var r=n,c=a.ads.state;a.ads.triggerevent=t.type,s[r].leave&&s[r].leave.apply(a.ads),s[c].enter&&s[c].enter.apply(a.ads),i.debug&&e.log("ads",a.ads.triggerevent+" triggered: "+r+" -> "+c)}},r=function(){var t=a.textTracks();if(!a.ads.shouldPlayContentBehindAd(a)&&a.ads.isAdPlaying()&&a.tech_.featuresNativeTextTracks&&e.browser.IS_IOS&&!Array.isArray(a.textTracks()))for(var n=0;n<t.length;n++){var i=t[n];"showing"===i.mode&&(i.mode="disabled")}};a.ready(function(){a.textTracks().addEventListener("change",r)}),a.on(b.concat(["adtimeout","contentupdate","contentplaying","contentended","contentresumed","adstart","adend","adskip","adsready","adserror","adscanceled","nopreroll"]),d),a.on("dispose",function(){a.ads.adTimeoutTimeout&&n.clearTimeout(a.ads.adTimeoutTimeout),a.ads._fireEndedTimeout&&n.clearTimeout(a.ads._fireEndedTimeout),a.ads.cancelPlayTimeout&&n.clearTimeout(a.ads.cancelPlayTimeout),a.ads.tryToResumeTimeout_&&a.clearTimeout(a.ads.tryToResumeTimeout_),a.textTracks().removeEventListener("change",r)}),a.paused()||d({type:"play"})};return(e.registerPlugin||e.plugin)("ads",S),S});