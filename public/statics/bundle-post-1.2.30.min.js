!function t(e,o,i){function n(r,s){if(!o[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=o[r]={exports:{}};e[r][0].call(d.exports,function(t){var o=e[r][1][t];return n(o?o:t)},d,d.exports,t,e,o,i)}return o[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(t,e,o){!function(t){t.fn.imageFitCover=function(e){var o,i=this,n=0,a=!1,r=!1,s=!1,l=function(e){if(!e.attr("width")&&!e.attr("height")){var o=new Image,i={};o.src=e.attr("src"),t(o).on("load",function(){var o=t(this)[0];i=o.naturalWidth?{width:o.naturalWidth,height:o.naturalHeight}:{width:o.width,height:o.height},e.attr(i)})}},c=function(e){if(e.length>0)for(var o=0;o<n;o++)l(t(e[o]))},d=function(t){if(o.length>t){var e,n,a=o.eq(t),l=0,c=0,d=0,u=0,h=0,f={width:"auto",height:"auto",left:0,top:0};u=i.eq(t).width(),h=i.eq(t).height(),n=u/h,c=a.attr("height")-0,l=a.attr("width")-0,c>0&&l>0&&(e=l/c,n>e?(f.width="100%",f.top=0-Math.abs((h-u/e)/2)+"px"):(f.height="100%",f.left=0-Math.abs((u-h*e)/2)+"px"),s&&(f.position="relative"),a.css(f),0!=d||r||(i.addClass("image-fit-cover"),r=!0))}},u=function(){if(o.length>0)for(var t=0;t<n;t++)d(t)},h=function(){if(n=i.length,n>0&&(o=i.find("img"),o.length>0)){var r=t("body");if(0==r.hasClass("object-fit-checked")){var l=document.createElement("div");a=!!(0+l.style["object-fit"]),r.addClass("object-fit-checked")}else a=r.hasClass("object-fit-supported");a?r.addClass("object-fit-supported"):(e||(e=10),"static"==o.eq(0).css("position")&&(s=!0),c(o),setTimeout(u,e),t(window).on("resize",u))}};return h(),this},t.fn.isSupportObjectFit=function(){var t=!1,e=document.createElement("div");return t=!!(0+e.style["object-fit"])},t.fn.getStyleProp=function(){function e(t){if(null==t||""==t)return"";var e=0,o=0,n=t.split(";");for(i=0,len=n.length;i<len;i++){var a=n[i],r=a.split(":");"top"===r[0].trim()?r[1].indexOf("%")>=0&&(e=1):"left"===r[0].trim()&&r[1].indexOf("%")>=0&&(o=1)}return!(!e||!o)}var o=this,n=0,a=o.width()-2*n,r=o.height()-2*n,s=o.find("img");if(!s)return"";var l=t(s[0]);if(!l)return"";100*parseFloat(l.css("width").replace("px",""))/a+"%",100*parseFloat(l.css("height").replace("px",""))/r+"%",100*parseFloat(l.css("left").replace("px",""))/a+"%",100*parseFloat(l.css("top").replace("px",""))/r+"%";return e(l.attr("style"))?l.attr("style"):void 0},t.fn.actImageResize=function(e,o,i){function n(t,e){if(null==t||""==t)return"";var o=t.split(";");for(d=0,len=o.length;d<len;d++){var i=o[d],n=i.split(":");if(n[0].trim()===e)return n[1].trim()}return""}i.isSupportObjectFit();var a,r,s=i.find("img"),l=0,c=0,d=0,u=0,h=0,f={width:"auto",height:"auto",left:0,top:0};if(s.length>0){var p=0,m=t(s[0]),g=m.attr("style");u=i.width()-2*p,h=i.height()-2*p,r=u/h,m[0].naturalWidth?(l=m[0].naturalWidth,c=m[0].naturalHeight):(l=m[0].width,c=m[0].height),a=l/c;var g=m.attr("cropStyle"),v=n(g,"width"),w=n(g,"height"),b=n(g,"left"),$=n(g,"top"),y=n(g,"h_width"),x=n(g,"h_height"),_=w.replace("px",""),A=parseFloat(_),k=v.replace("px",""),C=parseFloat(k),E=b.replace("px",""),S=parseFloat(E),I=$.replace("px",""),P=parseFloat(I),F=x.replace("px",""),B=parseFloat(F),N=y.replace("px",""),z=parseFloat(N),T=u/z,O=h/B;if(c>0&&l>0){if(""!=$&&""!=b)if(T>=O){var M=u/(z/C),R=M/a,U=S/C*M,j=P/A*R,H=Math.abs(z/B);f.width=M+"px",f.height=R+"px",f.left=U+"px",f.top=j-Math.abs((h-u/H)/2)+"px",console.log("fw:"+u),console.log("###1 width:"+M+" height:"+R+" left:"+U+" top:"+f.top)}else{var R=h/(B/A),M=R*a,U=S/C*M,j=P/A*R,H=Math.abs(z/B);f.width=M+"px",f.height=R+"px",f.top=j+"px",f.left=U-Math.abs((u-h*H)/2)+"px",console.log("###2 width:"+M+" height:"+R+" left:"+f.left+" top:"+j)}else r>a?(f.width="100%",f.top=0-Math.abs((h-u/a)/2)+"px"):(f.height="100%",f.left=0-Math.abs((u-h*a)/2)+"px");var D=!1;D&&(f.position="relative"),m.css(f)}}},t.fn.actImageFitCover=function(e){function o(t,e){if(null==t||""==t)return"";var o=t.split(";");for(d=0,len=o.length;d<len;d++){var i=o[d],n=i.split(":");if(n[0].trim()===e)return n[1].trim()}return""}var i,n,a=this,r=1,s=a.find("img"),l=0,c=0,d=0,u=0,h=0,f={width:"auto",height:"auto",left:0,top:0};if(s.length>0){var p=6,m=t(s[0]),g=m.attr(e);u=a.width()-2*p,h=a.height()-2*p,n=u/h,m[0].naturalWidth?(l=m[0].naturalWidth,c=m[0].naturalHeight):(l=m[0].width,c=m[0].height),i=l/c;var v=o(g,"width"),w=o(g,"height"),b=o(g,"left"),$=o(g,"top"),y=parseFloat(w),x=parseFloat(v),_=parseFloat(b),A=parseFloat($);if(c>0&&l>0){if(""!=$&&""!=b){var k=y*i/x;if(n>=k){var C=x,E=C*n/i,S=_,I=A*E/y,P=Math.abs(y*i/x);I+=100*(1-n/P)/2,I=I>0?0:I,f.width=C+"%",f.height=E+"%",f.left=S+"%",f.top=I+"%",console.log("###1 width:"+C+" height:"+E+" left:"+S+" top:"+f.top)}else{var E=y,C=E*i/n,S=_*C/x,I=A,P=Math.abs(y*i/x);S+=100*(1-P/n)/2,f.width=C+"%",f.height=E+"%",f.top=I+"%",f.left=S+"%",console.log("###2 width:"+C+" height:"+E+" left:"+f.left+" top:"+I)}}else n>i?(f.width="100%",f.top=0-Math.abs((h-u/i)/2)+"px"):(f.height="100%",f.left=0-Math.abs((u-h*i)/2)+"px");var F=!1;F&&(f.position="relative");var B=!1,N=document.createElement("div");B=!!(0+N.style["object-fit"]),B||m.css(f),r=n>=i?parseFloat(f.width)/100:parseFloat(f.height)/100}}return r}}(jQuery)},{}],2:[function(t,e,o){!function(t,e){function o(e){var o,i=t("<div></div>").css({width:"100%"});return e.append(i),o=e.width()-i.width(),i.remove(),o}function i(n,a){var r=n.getBoundingClientRect(),s=r.top,l=r.bottom,c=r.left,d=r.right,u=t.extend({tolerance:0,viewport:e},a),h=!1,f=u.viewport.jquery?u.viewport:t(u.viewport);f.length||(console.warn("isInViewport: The viewport selector you have provided matches no element on page."),console.warn("isInViewport: Defaulting to viewport as window"),f=t(e));var p=f.height(),m=f.width(),g=f[0].toString();if(f[0]!==e&&"[object Window]"!==g&&"[object DOMWindow]"!==g){var v=f[0].getBoundingClientRect();s-=v.top,l-=v.top,c-=v.left,d-=v.left,i.scrollBarWidth=i.scrollBarWidth||o(f),m-=i.scrollBarWidth}return u.tolerance=~~Math.round(parseFloat(u.tolerance)),u.tolerance<0&&(u.tolerance=p+u.tolerance),0>=d||c>=m?h:h=u.tolerance?s<=u.tolerance&&l>=u.tolerance:l>0&&p>=s}String.prototype.hasOwnProperty("trim")||(String.prototype.trim=function(){return this.replace(/^\s*(.*?)\s*$/,"$1")});var n=function(e){if(1===arguments.length&&"function"==typeof e&&(e=[e]),!(e instanceof Array))throw new SyntaxError("isInViewport: Argument(s) passed to .do/.run should be a function or an array of functions");for(var o=0;o<e.length;o++)if("function"==typeof e[o])for(var i=0;i<this.length;i++)e[o].call(t(this[i]));else console.warn("isInViewport: Argument(s) passed to .do/.run should be a function or an array of functions"),console.warn("isInViewport: Ignoring non-function values in array and moving on");return this};t.fn.do=function(t){return console.warn("isInViewport: .do is deprecated as it causes issues in IE and some browsers since it's a reserved word. Use $.fn.run instead i.e., $(el).run(fn)."),n(t)},t.fn.run=n;var a=function(e){if(e){var o=e.split(",");return 1===o.length&&isNaN(o[0])&&(o[1]=o[0],o[0]=void 0),{tolerance:o[0]?o[0].trim():void 0,viewport:o[1]?t(o[1].trim()):void 0}}return{}};t.extend(t.expr[":"],{"in-viewport":t.expr.createPseudo?t.expr.createPseudo(function(t){return function(e){return i(e,a(t))}}):function(t,e,o){return i(t,a(o[3]))}}),t.fn.isInViewport=function(t){return this.filter(function(e,o){return i(o,t)})}}(jQuery,window)},{}],3:[function(t,e,o){!function(t,e,o,i){var n=t(e);t.fn.lazyload=function(a){function r(){var e=0;l.each(function(){var o=t(this);if(!c.skip_invisible||o.is(":visible"))if(t.abovethetop(this,c)||t.leftofbegin(this,c));else if(t.belowthefold(this,c)||t.rightoffold(this,c)){if(++e>c.failure_limit)return!1}else o.trigger("appear"),e=0})}var s,l=this,c={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:e,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return a&&(i!==a.failurelimit&&(a.failure_limit=a.failurelimit,delete a.failurelimit),i!==a.effectspeed&&(a.effect_speed=a.effectspeed,delete a.effectspeed),t.extend(c,a)),s=c.container===i||c.container===e?n:t(c.container),0===c.event.indexOf("scroll")&&s.bind(c.event,function(){return r()}),this.each(function(){var e=this,o=t(e);e.loaded=!1,o.attr("src")!==i&&o.attr("src")!==!1||o.is("img")&&o.attr("src",c.placeholder),o.one("appear",function(){if(!this.loaded){if(c.appear){var i=l.length;c.appear.call(e,i,c)}t("<img />").bind("load",function(){var i=o.attr("data-"+c.data_attribute);o.hide(),o.is("img")?o.attr("src",i):o.css("background-image","url('"+i+"')"),o[c.effect](c.effect_speed),e.loaded=!0;var n=t.grep(l,function(t){return!t.loaded});if(l=t(n),c.load){var a=l.length;c.load.call(e,a,c)}}).attr("src",o.attr("data-"+c.data_attribute))}}),0!==c.event.indexOf("scroll")&&o.bind(c.event,function(){e.loaded||o.trigger("appear")})}),n.bind("resize",function(){r()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&n.bind("pageshow",function(e){e.originalEvent&&e.originalEvent.persisted&&l.each(function(){t(this).trigger("appear")})}),t(o).ready(function(){r()}),this},t.belowthefold=function(o,a){var r;return r=a.container===i||a.container===e?(e.innerHeight?e.innerHeight:n.height())+n.scrollTop():t(a.container).offset().top+t(a.container).height(),r<=t(o).offset().top-a.threshold},t.rightoffold=function(o,a){var r;return r=a.container===i||a.container===e?n.width()+n.scrollLeft():t(a.container).offset().left+t(a.container).width(),r<=t(o).offset().left-a.threshold},t.abovethetop=function(o,a){var r;return r=a.container===i||a.container===e?n.scrollTop():t(a.container).offset().top,r>=t(o).offset().top+a.threshold+t(o).height()},t.leftofbegin=function(o,a){var r;return r=a.container===i||a.container===e?n.scrollLeft():t(a.container).offset().left,r>=t(o).offset().left+a.threshold+t(o).width()},t.inviewport=function(e,o){return!(t.rightoffold(e,o)||t.leftofbegin(e,o)||t.belowthefold(e,o)||t.abovethetop(e,o))},t.extend(t.expr[":"],{"below-the-fold":function(e){return t.belowthefold(e,{threshold:0})},"above-the-top":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-screen":function(e){return t.rightoffold(e,{threshold:0})},"left-of-screen":function(e){return!t.rightoffold(e,{threshold:0})},"in-viewport":function(e){return t.inviewport(e,{threshold:0})},"above-the-fold":function(e){return!t.belowthefold(e,{threshold:0})},"right-of-fold":function(e){return t.rightoffold(e,{threshold:0})},"left-of-fold":function(e){return!t.rightoffold(e,{threshold:0})}})}(jQuery,window,document)},{}],4:[function(t,e,o){!function(t,e,o){"use strict";function i(t,e){this._defaults=n,this.element=t,this.setOptions(e),this.init()}var n={tagName:"a",newLine:"\n",target:"_blank",linkClass:null,linkClasses:[],linkAttributes:null};i.prototype={constructor:i,init:function(){1===this.element.nodeType?i.linkifyNode.call(this,this.element):this.element=i.linkify.call(this,this.element.toString())},setOptions:function(t){this.settings=i.extendSettings(t,this.settings)},toString:function(){return this.element.toString()}},i.extendSettings=function(t,e){var o;e=e||{};for(o in n)e[o]||(e[o]=n[o]);for(o in t)e[o]=t[o];return e},i.linkMatch=new RegExp(["(",'\\s|[^a-zA-Z0-9.\\+_\\/"\\>\\-]|^',")(?:","(","[a-zA-Z0-9\\+_\\-]+","(?:","\\.[a-zA-Z0-9\\+_\\-]+",")*@",")?(","http:\\/\\/|https:\\/\\/|ftp:\\/\\/",")?(","(?:(?:[a-z0-9][a-z0-9_%\\-_+]*\\.)+)",")(","(?:com|ca|co|edu|gov|net|org|dev|biz|cat|int|pro|tel|mil|aero|asia|coop|info|jobs|mobi|museum|name|post|travel|local|[a-z]{2})",")(","(?::\\d{1,5})",")?(","(?:","[\\/|\\?]","(?:","[\\-a-zA-Z0-9_%#*&+=~!?,;:.\\/]*",")*",")","[\\-\\/a-zA-Z0-9_%#*&+=~]","|","\\/?",")?",")(",'[^a-zA-Z0-9\\+_\\/"\\<\\-]|$',")"].join(""),"g"),i.emailLinkMatch=/(<[a-z]+ href=\")(http:\/\/)([a-zA-Z0-9\+_\-]+(?:\.[a-zA-Z0-9\+_\-]+)*@)/g,i.linkify=function(t,e){var o,n,a,r=[];this.constructor===i&&this.settings?(n=this.settings,e&&(n=i.extendSettings(e,n))):n=i.extendSettings(e),a=n.linkClass?n.linkClass.split(/\s+/):[],a.push.apply(a,n.linkClasses),t=t.replace(/</g,"&lt;").replace(/(\s)/g,"$1$1"),r.push("$1<"+n.tagName,'href="http://$2$4$5$6$7"'),r.push('class="linkified'+(a.length>0?" "+a.join(" "):"")+'"'),n.target&&r.push('target="'+n.target+'"');for(o in n.linkAttributes)r.push([o,'="',n.linkAttributes[o].replace(/\"/g,"&quot;").replace(/\$/g,"&#36;"),'"'].join(""));return r.push(">$2$3$4$5$6$7</"+n.tagName+">$8"),t=t.replace(i.linkMatch,r.join(" ")),t=t.replace(i.emailLinkMatch,"$1mailto:$3"),t=t.replace(/(\s){2}/g,"$1"),t=t.replace(/\n/g,n.newLine)},i.linkifyNode=function(t){var e,n,a,r,s;if(t&&"object"==typeof t&&1===t.nodeType&&"a"!==t.tagName.toLowerCase()&&!/[^\s]linkified[\s$]/.test(t.className)){for(e=[],r=i._dummyElement||o.createElement("div"),n=t.firstChild,a=t.childElementCount;n;){if(3===n.nodeType){for(;r.firstChild;)r.removeChild(r.firstChild);for(r.innerHTML=i.linkify.call(this,n.textContent||n.innerText||n.nodeValue),e.push.apply(e,r.childNodes);r.firstChild;)r.removeChild(r.firstChild)}else 1===n.nodeType?e.push(i.linkifyNode(n)):e.push(n);n=n.nextSibling}for(;t.firstChild;)t.removeChild(t.firstChild);for(s=0;s<e.length;s++)t.appendChild(e[s])}return t},i._dummyElement=o.createElement("div"),t.fn.linkify=function(e){return this.each(function(){var o;(o=t.data(this,"plugin-linkify"))?(o.setOptions(e),o.init()):t.data(this,"plugin-linkify",new i(this,e))})},t.fn.linkify.Constructor=i,t(e).on("load",function(){t("[data-linkify]").each(function(){var e,o=t(this),i=o.attr("data-linkify"),n={tagName:o.attr("data-linkify-tagname"),newLine:o.attr("data-linkify-newline"),target:o.attr("data-linkify-target"),linkClass:o.attr("data-linkify-linkclass")};for(var a in n)"undefined"==typeof n[a]&&delete n[a];e="this"===i?o:o.find(i),e.linkify(n)})}),t("body").on("click",".linkified",function(){var o=t(this),i=o.attr("href"),n=/^mailto:/i.test(i),a=o.attr("target");return n?e.location.href=i:e.open(i,a),!1})}(jQuery,window,document)},{}],5:[function(t,e,o){!function(e){function o(){$(".padding-overlay").siblings("img.lazy").each(function(){var t=$(this);t.lazyload({effect:"fadeIn",effectspeed:600,threshold:200,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=",load:function(){$(this).parent().actImageFitCover("style")}}),l.setRandomlyBackgroundColor(t)})}function i(){function t(t){t&&!CANNOT_SHOW_HEADER?$(".showPosts .head").is(":visible")||$(".showPosts .head").fadeIn(300):$(".showPosts .head").is(":visible")&&$(".showPosts .head").fadeOut(300)}function e(t){t?$(".socialContent .chatFooter").is(":visible")||$(".socialContent .chatFooter").fadeIn(300):$(".socialContent .chatFooter").is(":visible")&&$(".socialContent .chatFooter").fadeOut(300)}function i(){var o=$(window).scrollTop(),i=$(".discover .newLayout_element");return o<=40?(t(!0),e(!0),void(window.lastScroll=o)):!i.is(":in-viewport")&&u()-(o+$(window).height())<150?(t(!0),e(!0),void(window.lastScroll=o)):(window.lastScroll-o>5&&(t(!0),e(!0)),window.lastScroll-o<-5&&(t(!1),e(!1)),void(Math.abs(window.lastScroll-o)<5||(window.lastScroll=o)))}$("#wrapper .mainImage").css("height",.55*window.screen.height+"px"),$(".textDiv1Link").linkify(),localStorage.setItem("newFriendsCounts",20),calcLayoutForEachPubElement(),o();var n,a;n=$(".showPosts"),a=$(".showPosts").find(".content .gridster #test"),a.height()>1e3&&($(".showPosts").get(0).style.overflow="hidden",$(".showPosts").get(0).style.maxHeight="1500px",$(".showPosts").get(0).style.position="relative",n.after('<div class="readmore"><div class="readMoreContent"><i class="fa fa-plus-circle"></i>继续阅读</div></div>')),$(".showPostsBox .readmore").click(function(t){t.stopPropagation(),$(".showPosts").get(0).style.overflow="",$(".showPosts").get(0).style.maxHeight="",$(".showPosts").get(0).style.position="",$(".readmore").remove()}),c("post rended."),c("test height:",$("#test").height()),$(".showPostsBox").removeClass("default"),$(window).scroll(i),this.disablePostScroll=function(){$("body").css("overflow-y","hidden"),$(".showBgColor").css("position","fixed")},this.enablePostScroll=function(){$("body").css("overflow-y","auto"),$(".showBgColor").css("position","relative")},$("#downloadApp").click(function(){isIOS?trackEvent("Download","from Post Tail, IOS"):isAndroidFunc()?trackEvent("Download","from Post Tail, Android"):trackEvent("Download","from Post Tail, Outside Wechat"),window.open("http://a.app.qq.com/o/simple.jsp?pkgname=org.hotshare.everywhere","_system")}),$(".postAudioItem.element .play_area").click(function(){var t=$(this),e=t.find("audio");t.hasClass("music_playing")?(t.removeClass("music_playing"),e.trigger("pause")):(t.addClass("music_playing"),e.trigger("play"))});try{$("video")[0].onplaying=function(t){var e,o;if(o=$(t.currentTarget).parent(),o&&(e=o.find("video"),e&&e.get(0)))return e.siblings(".video_thumb").fadeOut(100)}}catch(t){c("no Video")}try{if($(".goChapter").length>0){var r=$(".goChapter").attr("chapterid");$(".goChapter").click(function(t){var e,o;e=$(".showPosts"),$(".showPosts").get(0).style.overflow="",$(".showPosts").get(0).style.maxHeight="",$(".showPosts").get(0).style.position="",$(".readmore").remove(),o=$("#"+r).offset().top,console.log("index is "+r),console.log(o),document.body.scrollTop=o})}}catch(t){c("no chapter")}$(".postVideoItem.element .play_area").click(function(t){var e=($(this),$(t.currentTarget)),o=e.find("video");o.get(0)&&(o.siblings(".video_thumb").fadeOut(100),o.get(0).paused?o.get(0).play():o.get(0).pause())}),$(".chatBtn").click(function(){var t="chat.tiegushi.com",e="http://"+t+"/channel/"+postid,o=localStorage.getItem("Meteor.userId");trackEvent("socialBar","GroupChat"),o&&(e+="/userid/"+o),window.open(e,"_blank")}),$(".postTextItem").click(function(){c("Need trigger section repost.");var t,e;t=$(this),e=t.data("toolbarObj"),e||(t.toolbar({content:".section-toolbar",position:"bottom",hideOnClick:!0}),t.on("toolbarItemClick",function(e,o){var i,n;i=parseInt(t.attr("index")),n="/t/"+postid+"/"+i,c(t.attr("index")),c("Event: "+e+" Button: "+o),window.location.href=n}),t.data("toolbarObj").show())});var s=function(){$("._bell-box").slideDown(300),location.hash="#bell"};$(".show-post-new-message").click(function(){s()}),$(".div_me .set-up .bell").click(function(){s()}),$("._bell-box .head").click(function(){location.hash="",window.CallMethod("clearUserBellWaitReadCount",[window._loginUserId]),$("._bell-box,.msg-box, _bell-box .readTips").css("display","none")}),"#bell"===location.hash&&s(),window.latestFavPostId="";var l=function(t,e,o){return!(parseInt($(t).text())>0)&&(!($(e).siblings(".pcomment").length>0)&&(!(o&&parseInt($(t.nextElementSibling).text())>0)&&!(!o&&parseInt($(t.previousElementSibling).text())>0)))},d=function(t,e){CallMethod("updateThumbs",[postid,window._loginUserId,t,e],function(t,e){c(e)})};$(".thumbsUp").click(function(t){var e=this,o=$(t.currentTarget).parent().parent().parent().attr("index"),i=parseInt($(e).text());if(o=parseInt(o),c("==点评index=="+o),"fa fa-thumbs-up thumbsUp"===t.target.className)d(o,"likeDel"),t.target.className="fa fa-thumbs-o-up thumbsUp",t.target.style.fontSize="small",$(e).text($(e).text().replace(/\d+/g,function(){return i>0?i-1:0})),l(e,t.target.parentNode.parentElement,!0)&&(t.target.parentNode.parentElement.style.color="rgb(0,0,0)");else if(latestFavPostId=postid,d(o,"likeAdd"),t.target.className="fa fa-thumbs-up thumbsUp",t.target.style.fontSize="larger",t.target.parentNode.parentElement.style.color="rgb(243,11,68)",$(e).text($(e).text().replace(/\d+/g,function(t){return i+1})),"fa fa-thumbs-down thumbsDown"===t.target.nextElementSibling.className){var n=parseInt($(e.nextElementSibling).text());$(e.nextElementSibling).text($(e.nextElementSibling).text().replace(/\d+/g,function(){return n>0?n-1:0})),t.target.nextElementSibling.className="fa fa-thumbs-o-down thumbsDown",t.target.nextElementSibling.style.color="rgb(243,11,68)"}}),$(".thumbsDown").click(function(t){var e=this,o=$(t.currentTarget).parent().parent().parent().attr("index"),i=parseInt($(e).text());if(o=parseInt(o),c("==点评index=="+o),"fa fa-thumbs-down thumbsDown"===t.target.className)d(o,"dislikeDel"),t.target.className="fa fa-thumbs-o-down thumbsDown",t.target.style.color="rgb(243,11,68)",$(e).text($(e).text().replace(/\d+/g,function(){return i>0?i-1:0})),l(e,t.target.parentNode.parentElement,!1)&&(t.target.parentNode.parentElement.style.color="rgb(0,0,0)");else if(d(o,"dislikeAdd"),t.target.className="fa fa-thumbs-down thumbsDown",t.target.style.color="blue",t.target.parentNode.parentElement.style.color="rgb(243,11,68)",$(e).text($(e).text().replace(/\d+/g,function(){return i+1})),"fa fa-thumbs-up thumbsUp"===t.target.previousElementSibling.className){var n=parseInt($(e.previousElementSibling).text());$(e.previousElementSibling).text($(e.previousElementSibling).text().replace(/\d+/g,function(){return n>0?n-1:0})),t.target.previousElementSibling.className="fa fa-thumbs-o-up thumbsUp",t.target.previousElementSibling.style.fontSize="small"}}),$(".pcomments").click(function(t){var e,o;window.CANNOT_SHOW_HEADER=!0,e=$(".alertBackground").height()-$(".showBgColor").height(),o=$(window).height()+$(window).scrollTop(),$(".showPosts .head").fadeOut(300),$(t.currentTarget).parent().parent().parent().addClass("post-pcomment-current-pub-item").attr("data-height",$(t.currentTarget).parent().parent().parent().height()),localStorage.setItem("pcommentPindex",$(t.currentTarget).parent().parent().parent().attr("index")),localStorage.setItem("pcommentParagraph",$(t.currentTarget).parent().parent().parent().attr("id")),$(".showBgColor").attr("style","overflow:hidden;min-width:"+$(window).width()+"px;height:"+o+"px;"),$(".pcommentInput,.alertBackground").fadeIn(300,function(){return $("#pcommitReport").focus()}),$("#pcommitReport").focus()}),$(".alertBackground").click(function(t){window.CANNOT_SHOW_HEADER=!1,$(".showPosts .head").fadeIn(300),$(".showBgColor").removeAttr("style"),$(".pcommentInput,.alertBackground").fadeOut(300)});var h=function(t,e){CallMethod("updatePcommitContent",[postid,window._loginUserId,t,e],function(t,e){c(e)})},f=function(){var t,e,o,i,n="匿名";if("undefined"!=typeof getMyUserInfo){var a=getMyUserInfo();a&&(a.profile&&a.profile.fullname?n=a.profile.fullname:a.username&&(n=a.username))}var r=localStorage.getItem("pcommentParagraph");i=parseInt(localStorage.getItem("pcommentPindex")),t=$("#pcommitReport").val(),c("==评论内容是=="+t),latestFavPostId=postid,$("#pcommitReport").val(""),$(".showBgColor").removeAttr("style"),""!=t&&null!=t&&(e='<div class="pcomment">                                        <div class="eachComment">                                        <div class="bubble" style="font-size: 14px;">',e+='<span class="personName">'+n+'</span>:<span class="personSay">'+t+"</span></div></div></div>",o='<div class="bubble"><span class="personName">'+n+'</span>:<span class="personSay">'+t+"</span></div>",$("#"+r).children(".pcomment").length>0?$("#"+r+" .pcomment").append(o):$("#"+r+" .inlineScoring").after(e),calcLayoutForEachPubElement(),h(i,t)),window.CANNOT_SHOW_HEADER=!1,$(".showPosts .head").fadeIn(300),$(".pcommentInput,.alertBackground").fadeOut(300)};$(".pcommentInput-form").submit(function(t){return $("#pcommitReport").blur(),setTimeout(f,0),!1}),$("#pcommitReportBtn").click(function(t){f()}),$(".postBtn").click(function(){$(".div_me_set-up-sex,.div_me_set-up-nike").css("display","none"),$(".contactsBtn, .postBtn, .discoverBtn, .meBtn").removeClass("focusColor"),$(".postBtn").addClass("focusColor"),$(".contactsList .head").is(":visible")&&$(".contactsList .head").fadeOut(300),enablePostScroll(),$(".div_contactsList").css("display","none"),$(".div_me").css("display","none"),document.body.scrollTop=0,trackEvent("socialBar","Post")}),$(".contactsBtn").click(function(){$(".div_me_set-up-sex,.div_me_set-up-nike").css("display","none"),localStorage.setItem("documentCurrTop",document.body.scrollTop),$(".socialContent .chatFooter").fadeIn(300),disablePostScroll(),trackEvent("socialBar","Newfrineds"),$(".contactsBtn, .postBtn, .discoverBtn, .meBtn").removeClass("focusColor"),$(".contactsBtn").addClass("focusColor"),$(".div_contactsList").css("display","block"),$(".div_me").css("display","none")}),$(".meBtn").click(function(){if(localStorage.setItem("documentCurrTop",document.body.scrollTop),$(".socialContent .chatFooter").fadeIn(300),disablePostScroll(),trackEvent("socialBar","Me"),""!==latestFavPostId&&0===$(".favposts ."+latestFavPostId).length){var t="",e=$(".mainImage img").attr("src"),o=$("#wx-title").html(),i=$("#wx-con").html();t+='<a href="http://'+window.location.host+"/t/"+latestFavPostId+'" style="color: #5A5A5A;"><div id="'+latestFavPostId+'" class="'+latestFavPostId+'" style="border-radius: 5px; background-color: #f7f7f7;"><div class="img_placeholder" style="margin: 0 0.125em 1em;-moz-page-break-inside: avoid;-webkit-column-break-inside: avoid;break-inside: avoid;background: white;border-radius:4px;"><img class="mainImage" src="'+e+'" style="width: 100%;border-radius: 4px 4px 0 0;"/><p class="title" style="font-size: 16px;font-weight: bold;white-space: pre-line;word-wrap: break-word;margin: 10px;">'+o+'</p><p class="addontitle" style="font-size:11px;margin: 10px;">'+i+"</p></div></div></a>",$(".favposts").attr("style","padding: 10px;background: #F1F1F1;-moz-column-count: 2;-webkit-column-count: 2;column-count: 2;-moz-column-width: 10em;-webkit-column-width: 10em;column-width: 10em;-moz-column-gap: 1em;-webkit-column-gap: 1em;column-gap: 1em;"),$(".favposts").append(t)}latestFavPostId="",$(".contactsBtn, .postBtn, .discoverBtn, .meBtn").removeClass("focusColor"),$(".meBtn").addClass("focusColor"),$(".div_contactsList").css("display","none"),$(".div_me").css("display","block")}),$(".div_contactsList .left-btn").click(function(){document.body.scrollTop=0,$(".div_contactsList").css("display","none"),enablePostScroll(),$(".contactsBtn").removeClass("focusColor"),$(".postBtn").addClass("focusColor")}),$(".div_me .set-up .nickname").click(function(){$(".div_me").hide(0,function(){$(".div_me_set-up-nike").show(0,function(){$("body").scrollTop($(".div_me_set-up-nike").offset().top)})})}),$(".div_me .socialTitle .left-btn").click(function(){document.body.scrollTop=0,$(".contactsBtn, .postBtn, .discoverBtn, .meBtn").removeClass("focusColor"),enablePostScroll(),$(".postBtn").addClass("focusColor"),$(".div_me").css("display","none")}),$(".div_me_set-up-nike .left-btn").click(function(){$(".div_me").css("display","block"),$(".div_me_set-up-nike").css("display","none")}),$(".div_me_set-up-nike .right-btn").click(function(){return $("#div_me_set-up-nike-input").val()?(window.CallMethod("updateUserNike",[window._loginUser._id,$("#div_me_set-up-nike-input").val()]),$(".div_me").css("display","block"),void $(".div_me_set-up-nike").css("display","none")):alert("请输入昵称~")}),$(".div_me .set-up .sex").click(function(){$(".div_me").css("display","none"),$(".div_me_set-up-sex").css("display","block"),$("body").scrollTop($(".div_me_set-up-sex").offset().top)}),$(".div_me_set-up-sex .left-btn").click(function(){$(".div_me").css("display","block"),$(".div_me_set-up-sex").css("display","none")}),$(".div_me_set-up-sex .setMale").click(function(){window.CallMethod("updateUserSex",[window._loginUser._id,"male"]),$(".div_me").css("display","block"),$(".div_me_set-up-sex").css("display","none")}),$(".div_me_set-up-sex .setFemale").click(function(){window.CallMethod("updateUserSex",[window._loginUser._id,"female"]),$(".div_me").css("display","block"),$(".div_me_set-up-sex").css("display","none")}),document.addEventListener("users",function(t){var e=t.detail;window._loginUser=e.fields,window._loginUser._id=e.id,$(".div_me .nickname .value").html(window._loginUser.profile.fullname+'<i class="fa fa-angle-right"></i>'),$("#div_me_set-up-nike-input").val(window._loginUser.profile.fullname),$(".div_me .sex .value").html((window._loginUser.profile.sex?"male"===window._loginUser.profile.sex?"男":"女":"[未知]")+'<i class="fa fa-angle-right"></i>'),window.CallMethod("profileData",[window._loginUser._id],function(t,e){c("profileData:",e);var o="";e.favouritePosts.forEach(function(t){o+='<a href="http://'+window.location.host+"/t/"+t._id+'" style="color: #5A5A5A;"><div id="'+t._id+'" class="'+t._id+'" style="border-radius: 5px; background-color: #f7f7f7;"><div class="img_placeholder" style="margin: 0 0.125em 1em;-moz-page-break-inside: avoid;-webkit-column-break-inside: avoid;break-inside: avoid;background: white;border-radius:4px;"><img class="mainImage" src="'+t.mainImage+'" style="width: 100%;border-radius: 4px 4px 0 0;"/><p class="title" style="font-size: 16px;font-weight: bold;white-space: pre-line;word-wrap: break-word;margin: 10px;">'+t.title+'</p><p class="addontitle" style="font-size:11px;margin: 10px;">'+t.addontitle+"</p></div></div></a>"}),$(".favposts").attr("style","padding: 10px;background: #F1F1F1;-moz-column-count: 2;-webkit-column-count: 2;column-count: 2;-moz-column-width: 10em;-webkit-column-width: 10em;column-width: 10em;-moz-column-gap: 1em;-webkit-column-gap: 1em;column-gap: 1em;"),$(".favposts").html(o),o="",e.mePosts.forEach(function(t){o+='<a href="http://'+window.location.host+"/t/"+t._id+'" style="color: #5A5A5A;"><li id="'+t.postId+'"><div class="img" style="background-image: url('+t.mainImage+');"></div><h1>'+t.title+"</h1></li></a>"}),o+='<div class="clear"></div>',$(".mePosts").html(o)})},!1),$(".authorInfos .subscribe").attr("id")!==window._loginUserId&&$("#SubscribeAuthor").show(),$(".authorReadPopularPostItem").click(function(){var t="/t/"+$(this).attr("id");window.open(t,"_system")}),$(".subscribeAutorPage .cannelBtn,.subscribeAutorPage .bg").on("click",function(){$(".subscribeAutorPage").hide()}),$(".subscribeAutorPage .okBtn").on("click",function(){var t,e,o;return t=$("#email").val(),c(t),e=new RegExp(/^[1-9][0-9]{4,9}$/),o=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/),""===t||!o.test(t)&&!e.test(t)?(toastr.remove(),toastr.info("请输入正确的QQ号或Email"),!1):(e.test(t)&&(t+="@qq.com"),$(".subscribeAutorPage").hide(),window.CallMethod("updateSubscribeAutorEmail",[$(".showPosts .user").attr("id"),window._loginUser._id,t],function(t,e){c("profileData is ==:"+JSON.stringify(e)),toastr.remove(),"success"===e.msg?toastr.success("您已成功关注作者"+$(".showPosts .user .name").html()+"，确认邮件将很快（10分钟左右）送达，谢谢！","关注成功"):toastr.error("关注失败，再试一次吧~")}),void trackEvent("Following","Email Follower"))}),$("#sendEmail").click(function(){$(".sendAuthorEmail,.authorEmailAlertBackground").show()}),this.hideAuthorEmail=function(){$(".sendAuthorEmail,.authorEmailAlertBackground").hide()},this.sendAuthorEmail=function(){var t,e,o,i;return e=$("#authorEmail").val(),t=$("#sendContent").val(),i=RegExp(/^[1-9][0-9]{4,9}$/),o=RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/),toastr.remove(),o.test(e)||i.test(e)?(i.test(e)&&(e+="@qq.com"),""===t?(toastr.info("请输入私信内容"),!1):($("#sendContent").val(""),$(".sendAuthorEmail,.authorEmailAlertBackground").hide(),window.CallMethod("sendAuthorEmail",[window._loginUser._id,window.postid,e,t]),void trackEvent("PrivateMsgAuthor","Private Msg author"))):(toastr.info("请输入正确的QQ号或Email"),!1)}}t("./libs/jquery.lazyload.1.9.3"),t("./libs/jquery.linkify"),t("./libs/image-fit-cover"),t("./libs/isInViewport.min"),e.gushitie||(e.gushitie={}),window.CANNOT_SHOW_HEADER=!1;var n=e.gushitie;n.showpost={};var a=["#55303e","#503f32","#7e766c","#291d13","#d59a73","#a87c5f","#282632","#ca9e92","#a7a07d","#846843","#6ea89e","#292523","#637168","#573e1b","#925f3e","#786b53","#aaa489","#a5926a","#6a6b6d","#978d69","#a0a1a1","#4b423c","#5f4a36","#b6a2a9","#1c1c4e","#e0d9dc","#393838","#c5bab3","#a46d40","#735853","#3c3c39"],r=0,s=a.length,l={},c=function(t){};
e.isIOS=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),e.isWeiXinFunc=function(){var t=window.navigator.userAgent.toLowerCase(),e=t.match(/MicroMessenger/i);return!(!e||"micromessenger"!==e[0])},e.isAndroidFunc=function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("android")>-1||t.indexOf("linux")>-1},l.setRandomlyBackgroundColor=function(t){t.css("background-color",a[r]),++r>=s&&(r=0)},e.padding=l;var d=function(){return($(".showPosts").width()-30)/6},u=function(){var t;return t=document,Math.max(Math.max(t.body.scrollHeight,t.documentElement.scrollHeight),Math.max(t.body.offsetHeight,t.documentElement.offsetHeight),Math.max(t.body.clientHeight,t.documentElement.clientHeight))},h=function(){return($(".showPosts").width()-30)/6},f=function(t,e,o){var i;i=0;for(var n=e;n<=e+o-1;n++)i=Math.max(i,t[n-1]);return i},p=function(t,e,o,i){for(var n=e;n<=e+o-1;n++)t[n-1]=i},m=function(t){return{index:Number(t.attr("index")),type:t.attr("type"),data_col:Number(t.attr("col")),data_sizex:Number(t.attr("sizex")),data_sizey:Number(t.attr("sizey"))}};this.getNewFriendReadCount=function(t){try{var e=parseInt($("#newFriendRedSpot").html()),o=t.length;c("newFriendReadCount is "+e);var i=e+o;e&&e>0?(c("newFriendReadCount"),o>0&&($.each(t,function(t,e){var o=this.ta;window.localStorage.getItem("newFriendRead_"+o)&&($("#"+o+" .red_spot").hide(),c("count plus 1"),i-=1)}),i>0?($("#newFriendRedSpot").show(),$("#newFriendRedSpot").html(i)):$("#newFriendRedSpot").hide()),c("final count is "+e)):o>0&&($.each(t,function(t,e){var i=this.ta;window.localStorage.getItem("newFriendRead_"+i)&&o--}),o>0?($("#newFriendRedSpot").show(),$("#newFriendRedSpot").html(o)):$("#newFriendRedSpot").hide())}catch(t){return}},this.calcLayoutForEachPubElement=function(){var t=[0,0,0,0,0,0],e=5;$("#test .element").each(function(o){var i=this,n=$(this),a=this.parentNode,r=m(n);0===r.index&&p(t,1,6,a.offsetTop),i.style.top=f(t,r.data_col,r.data_sizex)+e+"px";var s=a.offsetLeft+(r.data_col-1)*d(),l=r.data_sizex*d();1!==r.data_col&&(s+=e,l-=e),i.style.left=s+"px",i.style.width=l+"px","image"!==r.type&&"video"!==r.type&&"iframe"!==r.type||(i.style.height=r.data_sizey*h()+"px");var c=i.offsetTop+i.offsetHeight;if(p(t,r.data_col,r.data_sizex,c),a.style.height=f(t,1,6)-a.offsetTop+"px",n.next().length<=0&&location.hash.indexOf("#index_")!=-1){console.log("pub end."),$(".showPosts").get(0).style.overflow="",$(".showPosts").get(0).style.maxHeight="",$(".showPosts").get(0).style.position="",$(".readmore").remove();var u=location.hash.substr(location.hash.indexOf("#index_")+7);console.log("offset:",$("#test .element[index='"+u+"']").offset()),setTimeout(function(){document.body.scrollTop=$("#test .element[index='"+u+"']").offset().top},500)}})},$(document).ready(function(){i()})}(window)},{"./libs/image-fit-cover":1,"./libs/isInViewport.min":2,"./libs/jquery.lazyload.1.9.3":3,"./libs/jquery.linkify":4}]},{},[5]);
